@{
    ViewData["Title"] = "Changer Mon Mot de Passe";
}

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">
                    <i class="fas fa-key text-info"></i> Changer Mon Mot de Passe
                </h2>
                <a href="@Url.Action("Index", "Profile")" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Retour
                </a>
            </div>

            <!-- Messages -->
            @if (ViewBag.Error != null)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle"></i>
                    @ViewBag.Error
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-shield-alt"></i> Sécurité du Compte
                    </h5>
                </div>
                <div class="card-body">
                    <form asp-action="ChangePassword" method="post">
                        <!-- Mot de passe actuel -->
                        <div class="mb-4">
                            <label for="currentPassword" class="form-label">
                                <i class="fas fa-lock"></i> Mot de passe actuel
                            </label>
                            <input type="password" id="currentPassword" name="currentPassword" 
                                   class="form-control" required />
                            <small class="form-text text-muted">
                                Entrez votre mot de passe actuel pour confirmer votre identité
                            </small>
                        </div>

                        <!-- Nouveau mot de passe -->
                        <div class="mb-4">
                            <label for="newPassword" class="form-label">
                                <i class="fas fa-key"></i> Nouveau mot de passe
                            </label>
                            <input type="password" id="newPassword" name="newPassword" 
                                   class="form-control" required />
                            <small class="form-text text-muted">
                                Le mot de passe doit contenir au moins 6 caractères
                            </small>
                        </div>

                        <!-- Confirmation du nouveau mot de passe -->
                        <div class="mb-4">
                            <label for="confirmPassword" class="form-label">
                                <i class="fas fa-check-circle"></i> Confirmer le nouveau mot de passe
                            </label>
                            <input type="password" id="confirmPassword" name="confirmPassword" 
                                   class="form-control" required />
                            <small class="form-text text-muted">
                                Retapez le nouveau mot de passe pour éviter les erreurs
                            </small>
                        </div>

                        <!-- Indicateur de force du mot de passe -->
                        <div class="mb-4">
                            <label class="form-label">Force du mot de passe</label>
                            <div class="progress mb-2" style="height: 8px;">
                                <div id="passwordStrength" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <small id="passwordFeedback" class="form-text"></small>
                        </div>

                        <!-- Conseils de sécurité -->
                        <div class="alert alert-warning">
                            <h6 class="alert-heading">
                                <i class="fas fa-lightbulb"></i> Conseils pour un mot de passe sécurisé
                            </h6>
                            <ul class="mb-0">
                                <li>Utilisez au moins 8 caractères</li>
                                <li>Incluez des lettres majuscules et minuscules</li>
                                <li>Ajoutez des chiffres et des caractères spéciaux</li>
                                <li>Évitez les informations personnelles (nom, date de naissance, etc.)</li>
                                <li>N'utilisez pas le même mot de passe sur plusieurs sites</li>
                            </ul>
                        </div>

                        <!-- Boutons d'action -->
                        <div class="d-flex justify-content-between">
                            <a href="@Url.Action("Index", "Profile")" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </a>
                            <button type="submit" class="btn btn-info">
                                <i class="fas fa-save"></i> Changer le mot de passe
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Informations supplémentaires -->
            <div class="card mt-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle"></i> Informations importantes
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-success">
                                <i class="fas fa-check"></i> Bonnes pratiques
                            </h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-angle-right text-muted"></i> Changez régulièrement</li>
                                <li><i class="fas fa-angle-right text-muted"></i> Utilisez un gestionnaire</li>
                                <li><i class="fas fa-angle-right text-muted"></i> Activez l'authentification à deux facteurs</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-danger">
                                <i class="fas fa-times"></i> À éviter
                            </h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-angle-right text-muted"></i> Mot de passe trop simple</li>
                                <li><i class="fas fa-angle-right text-muted"></i> Réutilisation sur d'autres sites</li>
                                <li><i class="fas fa-angle-right text-muted"></i> Partage avec d'autres personnes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Validation du formulaire
            $('form').on('submit', function(e) {
                var currentPassword = $('#currentPassword').val();
                var newPassword = $('#newPassword').val();
                var confirmPassword = $('#confirmPassword').val();
                
                if (!currentPassword || !newPassword || !confirmPassword) {
                    alert('Tous les champs sont obligatoires.');
                    e.preventDefault();
                    return false;
                }
                
                if (newPassword.length < 6) {
                    alert('Le nouveau mot de passe doit contenir au moins 6 caractères.');
                    e.preventDefault();
                    return false;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('Les nouveaux mots de passe ne correspondent pas.');
                    e.preventDefault();
                    return false;
                }
                
                if (newPassword === currentPassword) {
                    alert('Le nouveau mot de passe doit être différent de l\'actuel.');
                    e.preventDefault();
                    return false;
                }
            });
            
            // Indicateur de force du mot de passe
            $('#newPassword').on('input', function() {
                var password = $(this).val();
                var strength = 0;
                var feedback = '';
                
                if (password.length >= 8) strength += 25;
                if (password.match(/[a-z]/)) strength += 25;
                if (password.match(/[A-Z]/)) strength += 25;
                if (password.match(/[0-9]/)) strength += 25;
                if (password.match(/[^a-zA-Z0-9]/)) strength += 25;
                
                var progressBar = $('#passwordStrength');
                var feedbackText = $('#passwordFeedback');
                
                if (strength <= 25) {
                    progressBar.removeClass().addClass('progress-bar bg-danger');
                    feedback = 'Très faible';
                } else if (strength <= 50) {
                    progressBar.removeClass().addClass('progress-bar bg-warning');
                    feedback = 'Faible';
                } else if (strength <= 75) {
                    progressBar.removeClass().addClass('progress-bar bg-info');
                    feedback = 'Moyen';
                } else {
                    progressBar.removeClass().addClass('progress-bar bg-success');
                    feedback = 'Fort';
                }
                
                progressBar.css('width', strength + '%');
                feedbackText.text(feedback);
            });
            
            // Confirmation du mot de passe en temps réel
            $('#confirmPassword').on('input', function() {
                var newPassword = $('#newPassword').val();
                var confirmPassword = $(this).val();
                
                if (confirmPassword && newPassword !== confirmPassword) {
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
        });
    </script>
} 